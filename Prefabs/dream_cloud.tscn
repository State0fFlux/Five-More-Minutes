[gd_scene load_steps=6 format=3 uid="uid://dencu3yac6vin"]

[ext_resource type="Texture2D" uid="uid://ck8ykgv80pswt" path="res://Sprites/environment/cloud.png" id="1_jk83v"]
[ext_resource type="PackedScene" uid="uid://c06hq2wkamsf7" path="res://Scenes/Dream.tscn" id="2_djysc"]

[sub_resource type="Shader" id="Shader_3gbim"]
code = "shader_type canvas_item;

uniform sampler2D cloud_mask; // Use a PNG with transparency
uniform float softness : hint_range(0.0, 0.5) = 0.05;

void fragment() {
    vec4 scene_tex = texture(TEXTURE, UV);
    float mask_alpha = texture(cloud_mask, UV).a;

    // Optional smoothing around edges
    float alpha = smoothstep(softness, 1.0, mask_alpha);
    COLOR = vec4(scene_tex.rgb, scene_tex.a * alpha);
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_nvmnl"]
shader = SubResource("Shader_3gbim")
shader_parameter/cloud_mask = ExtResource("1_jk83v")
shader_parameter/softness = 0.0

[sub_resource type="ViewportTexture" id="ViewportTexture_u27hw"]
viewport_path = NodePath("SubViewport")

[node name="Node2D" type="Node2D"]

[node name="DreamCloud" type="Sprite2D" parent="."]
position = Vector2(16, 5)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud"]
position = Vector2(-6, 5)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud"]
position = Vector2(-11, 0)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud"]
position = Vector2(-11, 2)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud"]
position = Vector2(-7, -5)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(-2, -7)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(3, -7)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(8, -3)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(9, -3)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(10, 3)
texture = ExtResource("1_jk83v")

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(6, 5)
texture = ExtResource("1_jk83v")

[node name="ColorRect" type="ColorRect" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
offset_left = -32.0
offset_top = -7.0
offset_right = -3.0
offset_bottom = 18.0

[node name="Cloud" type="Sprite2D" parent="DreamCloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud/Cloud"]
position = Vector2(-1, 6)
texture = ExtResource("1_jk83v")

[node name="SubViewport" type="SubViewport" parent="."]
handle_input_locally = false
size = Vector2i(288, 162)
render_target_update_mode = 4

[node name="Dream" parent="SubViewport" instance=ExtResource("2_djysc")]
metadata/_edit_lock_ = true

[node name="DreamWindow" type="TextureRect" parent="."]
clip_children = 2
material = SubResource("ShaderMaterial_nvmnl")
offset_left = -29.0
offset_top = -15.0
offset_right = 259.0
offset_bottom = 132.0
scale = Vector2(0.2, 0.2)
texture = SubResource("ViewportTexture_u27hw")
expand_mode = 3
stretch_mode = 4
metadata/_edit_lock_ = true
